!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@four/clock")):"function"==typeof define&&define.amd?define(["exports","@four/clock"],e):e(((t=t||self).Four=t.Four||{},t.Four.Loop={}),t.Four.Clock)}(this,function(t,e){"use strict";function n(t,e,n,i){return new(n||(n=Promise))(function(r,o){function u(t){try{a(i.next(t))}catch(t){o(t)}}function c(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(u,c)}a((i=i.apply(t,e||[])).next())})}function i(t,e){var n,i,r,o,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,i=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(r=(r=u.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){u.label=o[1];break}if(6===o[0]&&u.label<r[1]){u.label=r[1],r=o;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(o);break}r[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(t,u)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var r,o,u=Promise.resolve();"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?(r=requestAnimationFrame,o=cancelAnimationFrame):"function"==typeof setImmediate&&"function"==typeof clearImmediate&&(r=setImmediate,o=clearImmediate);var c=function(){function t(t){var n=this,i=void 0===t?{}:t,o=i.interval,c=void 0===o?0:o,a=i.fixed,s=void 0!==a&&a,l=i.type,f=void 0===l?"immediate":l,h=i.clockType,p=void 0===h?void 0:h,d=i.clock,v=void 0===d?new e.Clock({type:p}):d;this.throttle=e.Clock.throttle(function(){return n.interval}),this.handlers=new Set,this.running=!1,this.promise=u,this.handler=function(){return n.tick()},this.requestImmediate=function(){n.tick(),n.immediateID=r(n.requestImmediate)},this.requestInterval=function(){n.tick(),n.intervalID=setInterval(n.handler,n.interval||1)},this.cancelInterval=function(){clearInterval(n.intervalID),n.intervalID=void 0},this.type=f,this.interval=c,this.fixed=s,this.clock=v,this.clock.interval=function(t){return n.fixed?n.interval:n.throttle(t)}}return t.delay=function(t){return n(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){return setTimeout(e,t)})];case 1:return e.sent(),[2]}})})},t.repeat=function(t,e){return n(this,void 0,void 0,function(){var n,r;return i(this,function(i){switch(i.label){case 0:return n=new this({interval:t,type:"interval"}),r=n.repeat(e),n.start(),[4,r];case 1:return i.sent(),n.stop(),[2]}})})},t.prototype.cancelImmediate=function(){o(this.immediateID),this.immediateID=void 0},t.prototype.request=function(){"immediate"===this.type&&r?this.requestImmediate():this.requestInterval()},t.prototype.cancel=function(){"immediate"===this.type&&o?this.cancelImmediate():this.cancelInterval()},t.prototype.delay=function(t){return n(this,void 0,void 0,function(){return i(this,function(e){return t+=this.clock.elapsed,[2,this.repeat(function(e){return e.elapsed<=t})]})})},t.prototype.repeat=function(t){return n(this,void 0,void 0,function(){var e=this;return i(this,function(n){return[2,new Promise(function(n){var i=function(r){!1===t(r)&&(e.remove(i),n())};e.add(i)})]})})},t.prototype.add=function(t){return this.handlers.add(t),this},t.prototype.remove=function(t){return this.handlers.delete(t),this},t.prototype.tick=function(){var t=this.clock.tick();return t.delta&&this.handlers.forEach(function(e){return e(t)}),this},t.prototype.start=function(){var t=this;return this.running||(this.running=!0,this.promise=new Promise(function(e){t.resolve=e}),this.clock.reset(),this.request()),this},t.prototype.stop=function(){return this.running&&(this.cancel(),this.resolve(),this.running=!1,this.promise=u),this},t.prototype.reset=function(){return this.clock.reset(!0),this},t}();t.Loop=c,t.delay=function(t){return c.delay(t)},t.repeat=function(t,e){return c.repeat(t,e)},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
