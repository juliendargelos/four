{"version":3,"file":"index.umd.js","sources":["../src/record.ts","../src/recordable.ts"],"sourcesContent":["import { Clock } from '@four/clock'\nimport { Loop } from '@four/loop'\n\nclass Record extends Loop {\n  private callback?: (clock: Clock) => Promise<void> | void\n  private started: boolean = false\n  private canceled: boolean = false\n  public maximumDuration: number = Infinity\n\n  public constructor() {\n    super({ interval: 1 })\n  }\n\n  protected async request(): Promise<void> {\n    if (this.canceled) return\n\n    this.tick()\n    await (this.callback && this.callback(this.clock))\n\n    if (\n      (this.empty && this.started) ||\n      this.clock.elapsed >= this.maximumDuration\n    ) {\n      this.stop()\n    } else {\n      await this.request()\n    }\n  }\n\n  protected cancel(): void {\n    this.canceled = true\n  }\n\n  public get empty(): boolean {\n    return !this.handlers.size\n  }\n\n  public get fixed(): boolean {\n    return true\n  }\n\n  public set fixed(fixed: boolean) {\n\n  }\n\n  public start(): this {\n    if (!this.running) {\n      this.canceled = false\n      this.started = false\n    }\n\n    return super.start()\n  }\n\n  public stop(): this {\n    super.stop().handlers.clear()\n    return this\n  }\n\n  public reset({\n    interval = 1,\n    maximumDuration = Infinity,\n    callback = undefined\n  }: {\n    interval?: number\n    maximumDuration?: number\n    callback?: (clock: Clock) => Promise<void> | void\n  } = {}): this {\n    super.reset()\n    this.interval = interval\n    this.maximumDuration = maximumDuration\n    this.callback = callback\n    return this\n  }\n\n  public add(handler: (clock: Clock) => void): this {\n    this.started = true\n    return super.add(handler)\n  }\n}\n\nconst record = new Record()\n\nexport { record as Record }\n","import { Loop } from '@four/loop'\nimport { Record } from './record'\n\nconst delay = Loop.delay\n\nconst { request, cancel } = Loop.prototype as unknown as Loop & {\n  request(): void\n  cancel(): void\n}\n\nclass Recordable extends Loop {\n  private _interval!: number\n  private _fixed!: boolean\n\n  public static delay(duration: number): Promise<void> {\n    return Record.running\n      ? Record.delay(duration)\n      : delay.call(this, duration)\n  }\n\n  public get interval(): number {\n    return Record.running ? Record.interval : this._interval\n  }\n\n  public set interval(interval: number) {\n    this._interval = interval\n  }\n\n  public get fixed(): boolean {\n    return Record.running ? Record.fixed : this._fixed\n  }\n\n  public set fixed(fixed: boolean) {\n    this._fixed = fixed\n  }\n\n  protected request(): void {\n    Record.running\n      ? Record.add(this.handler)\n      : request.call(this)\n  }\n\n  protected cancel(): void {\n    Record.running\n      ? Record.remove(this.handler)\n      : cancel.call(this)\n  }\n}\n\nconst staticProperties = Object.getOwnPropertyDescriptors(Recordable)\nconst properties = Object.getOwnPropertyDescriptors(Recordable.prototype)\n\ndelete staticProperties.prototype\n\nObject.defineProperties(Loop, staticProperties)\nObject.defineProperties(Loop.prototype, properties)\n"],"names":["record","_super","interval","_this","Infinity","tslib_1.__extends","Record","this","canceled","tick","callback","clock","_a","empty","started","elapsed","maximumDuration","stop","request","Object","handlers","size","fixed","running","start","clear","_b","_c","_d","_e","reset","handler","add","Loop","delay","cancel","Recordable","duration","call","_interval","_fixed","remove","staticProperties","getOwnPropertyDescriptors","properties","prototype","defineProperties"],"mappings":"wmDAGA,IA8EMA,EAAS,gBAxEb,aAAA,MACEC,YAAM,CAAEC,SAAU,iBALZC,WAAmB,EACnBA,YAAoB,EACrBA,kBAA0BC,EAAAA,IAwEnC,OA5EqBC,OAUHC,oBAAhB,gGACE,OAAIC,KAAKC,cAETD,KAAKE,UACEF,KAAKG,UAAYH,KAAKG,SAASH,KAAKI,uBAA3CC,SAGGL,KAAKM,OAASN,KAAKO,SACpBP,KAAKI,MAAMI,SAAWR,KAAKS,iBAE3BT,KAAKU,2BAEL,SAAMV,KAAKW,kBAAXN,uSAIMN,mBAAV,WACEC,KAAKC,UAAW,GAGlBW,sBAAWb,yBAAX,WACE,OAAQC,KAAKa,SAASC,sCAGxBF,sBAAWb,yBAAX,WACE,OAAO,OAGT,SAAiBgB,qCAIVhB,kBAAP,WAME,OALKC,KAAKgB,UACRhB,KAAKC,UAAW,EAChBD,KAAKO,SAAU,GAGVb,YAAMuB,kBAGRlB,iBAAP,WAEE,OADAL,YAAMgB,gBAAOG,SAASK,QACflB,MAGFD,kBAAP,SAAaM,OAAAc,kBACXC,aAAAzB,iBACA0B,oBAAAZ,mBACAa,aAAAnB,sBAUA,OAJAT,YAAM6B,iBACNvB,KAAKL,SAAWA,EAChBK,KAAKS,gBAAkBA,EACvBT,KAAKG,SAAWA,EACTH,MAGFD,gBAAP,SAAWyB,GAET,OADAxB,KAAKO,SAAU,EACRb,YAAM+B,cAAID,OA1EAE,SCAfC,EAAQD,OAAKC,MAEbtB,mBAAEM,YAASiB,yBAKjB,4DAqCA,OArCyB9B,OAIT+B,QAAd,SAAoBC,GAClB,OAAO/B,EAAOiB,QACVjB,EAAO4B,MAAMG,GACbH,EAAMI,KAAK/B,KAAM8B,IAGvBlB,sBAAWiB,4BAAX,WACE,OAAO9B,EAAOiB,QAAUjB,EAAOJ,SAAWK,KAAKgC,eAGjD,SAAoBrC,GAClBK,KAAKgC,UAAYrC,mCAGnBiB,sBAAWiB,yBAAX,WACE,OAAO9B,EAAOiB,QAAUjB,EAAOgB,MAAQf,KAAKiC,YAG9C,SAAiBlB,GACff,KAAKiC,OAASlB,mCAGNc,oBAAV,WACE9B,EAAOiB,QACHjB,EAAO0B,IAAIzB,KAAKwB,SAChBb,EAAQoB,KAAK/B,OAGT6B,mBAAV,WACE9B,EAAOiB,QACHjB,EAAOmC,OAAOlC,KAAKwB,SACnBI,EAAOG,KAAK/B,UAnCK0B,QAuCnBS,EAAmBvB,OAAOwB,0BAA0BP,GACpDQ,EAAazB,OAAOwB,0BAA0BP,EAAWS,kBAExDH,EAAiBG,UAExB1B,OAAO2B,iBAAiBb,OAAMS,GAC9BvB,OAAO2B,iBAAiBb,OAAKY,UAAWD"}